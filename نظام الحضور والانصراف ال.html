<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù Ø§Ù„Ù…ØªØ·ÙˆØ±</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ */
        body {
            font-family: 'Arial', sans-serif;
            background: #f0f4f8;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 20px auto;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            padding: 30px;
        }

        .button-group {
            display: grid;
            gap: 15px;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            margin: 20px 0;
        }

        button {
            padding: 12px;
            border-radius: 8px;
            font-weight: bold;
            transition: transform 0.2s, opacity 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            opacity: 0.9;
        }

        table {
            width: 100%;
            margin-top: 25px;
            border-collapse: collapse;
            background: white;
        }

        th, td {
            padding: 12px;
            border: 1px solid #e0e0e0;
        }

        th {
            background: #f8f9fa;
            color: #2c3e50;
        }

        .event-cell {
            border-radius: 20px;
            padding: 5px 12px;
            display: inline-block;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            table {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="color: #2c3e50; text-align: center; margin-bottom: 30px;">ğŸ•’ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©</h1>

        <div class="input-section">
            <input type="text" 
                   id="employee-name" 
                   placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù Ø¨Ø§Ù„ÙƒØ§Ù…Ù„..." 
                   class="form-input"
                   style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; margin-bottom: 15px;">
            <div id="error-message" style="color: #e74c3c; margin-bottom: 15px;"></div>
        </div>

        <div class="button-group">
            <button id="check-in" style="background: #27ae60;">
                <i class="fas fa-door-open"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            </button>
            <button id="check-out" style="background: #c0392b;">
                <i class="fas fa-door-closed"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
            </button>
            <button id="absent" style="background: #f1c40f; color: #2c3e50;">
                <i class="fas fa-exclamation-triangle"></i> Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† ØºÙŠØ§Ø¨
            </button>
        </div>

        <div class="history-section">
            <button id="toggle-history" style="background: #3498db; width: 100%; margin: 15px 0;">
                <i class="fas fa-history"></i> Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠØ©
            </button>

            <div id="history-panel" style="display: none;">
                <input type="date" id="history-date" 
                       style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; margin: 10px 0;">
                <div class="history-actions">
                    <button id="fetch-history" style="background: #2ecc71;">
                        <i class="fas fa-search"></i> Ø¨Ø­Ø«
                    </button>
                    <button id="clear-history" style="background: #95a5a6;">
                        <i class="fas fa-trash"></i> Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„Ø§Øª
                    </button>
                </div>
            </div>
        </div>

        <div class="stats-section" style="margin-top: 25px;">
            <table id="attendance-table">
                <thead>
                    <tr>
                        <th>Ø§Ù„Ù…ÙˆØ¸Ù</th>
                        <th>Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª</th>
                        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                </tbody>
            </table>
        </div>
    </div>

<script>
// ---- ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ----
const storageKey = date => `attendance_${date}`;

// ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø¥Ù„Ù‰ ØªÙ†Ø³ÙŠÙ‚ Ø¹Ø±Ø¨ÙŠ ØªÙØµÙŠÙ„ÙŠ
const formatArabicDate = (dateString) => {
    const options = {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        hour: 'numeric',
        minute: 'numeric'
    };
    return new Date(dateString).toLocaleDateString('ar-EG', options);
};

// Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
const validate = {
    name: name => {
        if (!name.trim()) return 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù';
        if (!/^[\u0600-\u06FF\s]+$/.test(name)) return 'Ø§Ù„Ø§Ø³Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙÙ‚Ø·';
        return null;
    },
    action: (name, type, date) => {
        const records = JSON.parse(localStorage.getItem(storageKey(date)) || '[]');
        const existing = records.find(r => r.name === name && r.type === type);
        return existing ? `ØªÙ… ØªØ³Ø¬ÙŠÙ„ ${type} Ù…Ø³Ø¨Ù‚Ø§Ù‹ Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¸Ù` : null;
    }
};

// Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ø¬Ù„Ø§Øª
const recordsManager = {
    add: (name, type) => {
        const now = new Date();
        const dateKey = now.toISOString().split('T')[0];
        const record = {
            name,
            type,
            timestamp: now.toISOString()
        };
        
        const records = JSON.parse(localStorage.getItem(storageKey(dateKey)) || '[]');
        records.push(record);
        localStorage.setItem(storageKey(dateKey), JSON.stringify(records));
        return records;
    },

    get: date => {
        return JSON.parse(localStorage.getItem(storageKey(date)) || '[]');
    },

    clear: date => {
        localStorage.removeItem(storageKey(date));
    }
};

// Ù†Ø¸Ø§Ù… ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
const UI = {
    updateTable: (records) => {
        const tbody = document.querySelector('#attendance-table tbody');
        tbody.innerHTML = records.map(record => `
            <tr>
                <td>${record.name}</td>
                <td>${formatArabicDate(record.timestamp)}</td>
                <td>
                    <span class="event-cell" style="background: ${
                        record.type === 'Ø­Ø¶ÙˆØ±' ? '#27ae60' : 
                        record.type === 'Ø§Ù†ØµØ±Ø§Ù' ? '#c0392b' : '#f1c40f'
                    }">
                        ${record.type}
                    </span>
                </td>
            </tr>
        `).join('');
    },

    showAlert: (message, type = 'info') => {
        const colors = {
            success: '#27ae60',
            error: '#c0392b',
            info: '#3498db'
        };
        alert(message); // ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ù‡Ø°Ø§ Ø¨Ù…ÙƒØªØ¨Ø© ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø£ÙØ¶Ù„
    }
};

// ---- Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù†Ø¸Ø§Ù… ----
document.querySelectorAll('button[id]').forEach(btn => {
    btn.addEventListener('click', async () => {
        const name = document.getElementById('employee-name').value.trim();
        const errorElement = document